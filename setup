#!/usr/bin/env bash

if [ ! which brew > /dev/null 2>&1 ]
then
  bash -c 'ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"'
  brew bundle install --file=$(pwd)/brewrc
fi

newdir=$HOME/.dotfiles
bakdir=$HOME/.dotfiles.bak

rm -rf $bakdir
mkdir -p $bakdir
cd $newdir

for file in `ls`
do
  if [ "$file" != "README.md" ] && [ "$file" != "setup" ]
  then
    if [ -e "$HOME/.$file" ]
    then
      mv $HOME/.$file $bakdir
    fi
    ln -s $newdir/$file $HOME/.$file
  fi
done

mkdir -p $HOME/.config/git
ln -s $newdir/gitignore $HOME/.config/git/ignore
ln -s $newdir/gitconfig $HOME/.config/git/config

mkdir -p $HOME/.vim/{autoload,backup,bundle,colors,tmp,undo}
